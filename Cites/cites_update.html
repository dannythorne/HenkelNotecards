<!DOCTYPE html>
<html>
<head>
<link href="../css/common.css" rel="stylesheet" type="text/css" />
<title>Update a Reference</title>
</head>
<body>
<h1>Update a Reference</h1>

<form id="updateform" name="updateform">
<div id="citesdropdown">
</div>

<div id="citesedit">
</div>

</form>

<div id="console">
</div>

<script>
var genSelect = function()
{
  var req = new XMLHttpRequest();

  req.onreadystatechange = function()
  {
    if( req.readyState == 4 && req.status == 200 )
    {
      var div = document.getElementById("citesdropdown");
      var select = document.createElement("select");
      select.innerHTML = req.responseText; // option elements
      select.name = "cites_select";
      select.onchange = genEdit;
      div.appendChild(select);
    }
  }

  req.open("GET","cites_options.php",true);
  req.send();
}

var genEdit = function()
{
  var select = document.updateform.cites_select;
  var ids = select.value.split(" ");
  if( select.value)
  {
    var div = document.getElementById("citesedit");
    div.innerHTML = "Edit: ";
    div.innerHTML+= "Notecard ";
    div.innerHTML+= ids[1];
    div.innerHTML+= " cites work ";
    div.innerHTML+= ids[0];
    div.innerHTML+= " at ";
    var input = document.createElement("input");
    input.value = select.options[select.selectedIndex].text;
    input.name = "updatefield";
    div.appendChild(input);
    var button = document.createElement("button");
    button.type = "button";
    button.innerHTML = "Update";
    button.name = "Update";
    button.onclick = handleUpdate;
    div.appendChild(button);
  }
}

var handleUpdate = function()
{
  // TODO: AJAX call to PHP script.

  // The following is temporary just to facilitate developing.
  var console = document.getElementById("console");
  console.innerHTML = "";
  console.innerHTML+= "update Cites set coords='";
  console.innerHTML+= document.updateform.updatefield.value;
  console.innerHTML+= "' where WorkId=TODO and NotecardId=TODO;";
}

window.onload = function()
{
  genSelect();
  genEdit();
}
</script>

</body>
</html>
